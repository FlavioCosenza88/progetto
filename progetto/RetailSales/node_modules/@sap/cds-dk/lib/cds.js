const _local = id => require(_resolve(id))

/** @type { import('@sap/cds/lib') } */
const cds = module.exports = _local ('@sap/cds')

// for internal use in cds-dk only
cds._log = _local ('@sap/cds/bin/utils/log')
cds._local = _local

if (/^(4\.[56]|5|6\.[01])\b/.test(cds.version)) {
  // cds.debug may return false as of @sap/cds@(>=4.5 && < 6.2).
  // Patch this to be able to call `cds.debug(label)?.(message)`.
  // REVISIT remove once we no longer support these versions
  Object.defineProperty(cds, 'debug', {
    value: function cds_debug_patched (module, options) {
      const L = cds.log (module, options)
      if (L._debug) return L.debug
    }
  })
}

function _resolve (id) {
  return require.resolve (id, {paths:[
    process.cwd(), // project-local module is preferred
    __dirname      // otherwise from our own dependencies
  ]})
}
