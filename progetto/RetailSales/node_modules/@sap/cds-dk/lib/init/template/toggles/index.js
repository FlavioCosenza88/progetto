const { join } = require('path')
const { readProject } = require('../../util/projectReader')
const { mergeJSON, sortDependencies } = require('../../util/merge')

module.exports = class TogglesTemplate extends require('../templateBase') {

  static hasFacet(env) {
    return !!env.requires?.toggles
  }

  async run() {
    const projectDescriptor = await readProject(this.options)
    const { isNodejs , configFile} = projectDescriptor.cap
    await mergeJSON(configFile, join(__dirname, 'files', 'package.json.hbs'), projectDescriptor)
    if (isNodejs) await sortDependencies('package.json')
    await this.runDependentMerging()
  }
}
